# Чат-бот для анкетирования незрячих и слабовидящих

Telegram-бот для проведения опросов с функциями доступности для слабовидящих и незрячих пользователей, включая озвучивание текста и распознавание речи.

## Технологий

- **Среда выполнения**: Node.js 20.9.0+
- **Менеджер пакетов**: npm 10.1.0+
- **Основные библиотеки**:
  - `node-telegram-bot-api` ^0.66.0 - обертка для Telegram Bot API
  - `axios` ^1.12.2 - HTTP-клиент для API-запросов
  - `dotenv` ^17.2.2 - управление переменными окружения
- **Инструменты разработки**:
  - `nodemon` ^3.1.10 - автоматическая перезагрузка при разработке

## Внешние сервисы

- [Telegram Bot API](https://core.telegram.org/bots/api) - платформа для ботов
- [Yandex SpeechKit](https://cloud.yandex.ru/services/speechkit) - сервисы синтеза и распознавания речи

## Функциональность

- Два режима опроса: доступная версия для слабовидящих пользователей и стандартная веб-версия
- Поддержка голосового ввода с автоматическим распознаванием речи
- Озвучивание всех сообщений бота
- Поддержка различных типов вопросов: выбор варианта, чекбокс, дата, текст, текстовое поле
- Элементы навигации: повтор вопроса, возврат назад, пропуск необязательных вопросов
- Автоматическая валидация ответов (формат даты, формат номера телефона)
- Управление сессиями для нескольких пользователей

## Требования

- Node.js версии 20.9.0 или выше
- npm версии 10.1.0 или выше
- Токен Telegram-бота (получить у [@BotFather](https://t.me/botfather))
- API-ключ Yandex Cloud с доступом к SpeechKit
- API-endpoint бэкенда для управления формами

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/Eugene-Bykovsky/chatbot_form_assistant_backend.git
cd accessibillity-survey-bot
```

2. Установите зависимости:
```bash
npm i
```

3. Создайте файл `.env` в корневой директории:
```env
BOT_TOKEN=ваш_токен_telegram_бота
API_BASE_URL=url_вашего_backend_api
FORM_ID=идентификатор_вашей_формы
YANDEX_API_KEY=ваш_api_ключ_yandex
```

## Режим разработки

Для запуска бота в режиме разработки с автоматической перезагрузкой:

```bash
npm run dev
```

Бот запустится и будет автоматически перезапускаться при изменении файлов.

## Переменные окружения

| Переменная | Описание | Обязательна |
|----------|-------------|----------|
| `BOT_TOKEN` | Токен Telegram Bot API | Да |
| `API_BASE_URL` | Базовый URL бэкенд API | Да |
| `FORM_ID` | Идентификатор формы для опроса | Да |
| `YANDEX_API_KEY` | API-ключ Yandex Cloud для SpeechKit | Да |

## Структура проекта

```
accessibillity-survey-bot/
├── index.js           # Основная логика бота
├── temp/              # Временная директория для голосовых файлов (создается автоматически)
├── .env               # Переменные окружения (не в репозитории)
├── package.json       # Зависимости проекта и скрипты
├── package-lock.json  # Зафиксированные версии зависимостей
└── README.md          # Этот файл
```

## Команды бота

- `/start` - Запуск бота и выбор режима опроса

## Взаимодействие с пользователем

### Текстовые команды
- `1` - Выбрать доступную версию
- `2` - Выбрать стандартную версию
- `0` или "повторить" - Повторить текущий вопрос
- "назад" - Перейти к предыдущему вопросу
- "пропустить" - Пропустить необязательный вопрос
- Число (1-N) - Выбрать вариант ответа по номеру

### Голосовые команды
Пользователи могут отправлять голосовые сообщения с теми же командами или давать прямые ответы в рамкам вопроса формы.

## API-эндпоинты

Бот взаимодействует со следующими эндпоинтами бэкенда:

- `GET /api/form/{formId}/questions/` - Получение вопросов формы
- `POST /api/form/{formId}/submit/` - Отправка ответов формы

## Обработка ошибок

Бот включает комплексную обработку ошибок для:
- Проблем с подключением к API
- Сбоев распознавания речи
- Некорректного пользовательского ввода
- Ошибок управления сессиями

Все ошибки логируются в консоль, а пользователям отправляются понятные сообщения.
